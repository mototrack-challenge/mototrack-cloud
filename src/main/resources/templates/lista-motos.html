<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MotoTrack - Lista de Motos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link rel="stylesheet" th:href="@{/css/lista-motos.css}" />
    <link rel="stylesheet" th:href="@{/css/cabecalho-rodape.css}" />
    <script th:src="@{/js/modal-lista-motos.js}" defer></script>
  </head>
  <body>
    <div th:replace="fragments/header :: headerFragment"></div>

    <main class="container_main">
      <section class="resumo_titulo">
        <h2>Motos por Departamento</h2>
        <p>Resumo do status das motos cadastradas</p>
      </section>
  
      <section class="resumo_cards">
        <div class="card card_cadastradas">
          <i class="fas fa-motorcycle"></i>
          <h2 th:text="${resumo.cadastradas}">0</h2>
          <p>Cadastradas</p>
        </div>

        <div class="card card_analise">
          <i class="fas fa-search"></i>
          <h2 th:text="${resumo.avaliacao}">0</h2>
          <p>Avaliação</p>
        </div>

        <div class="card card_manutencao">
          <i class="fas fa-tools"></i>
          <h2 th:text="${resumo.manutencao}">0</h2>
          <p>Manutenção</p>
        </div>

        <div class="card card_prontas">
          <i class="fas fa-check-circle"></i>
          <h2 th:text="${resumo.prontasParaUso}">0</h2>
          <p>Prontas para Uso</p>
        </div>
      </section>

      <section class="filtros">
        <div class="filtros_titulo">
          <i class="fas fa-filter"></i>
          <h3>Filtros de Busca</h3>
        </div>

        <form th:action="@{/motos}" method="get" >
          <div class="filtros_inputs">
              <div class="input-group">
                <label for="placa">Placa</label>
                <input type="text" id="placa" name="placa"
                       placeholder="Ex: ABC1234" th:value="${param.placa}"/>
              </div>

              <div class="input-group">
                <label for="chassi">Chassi</label>
                <input type="text" id="chassi" name="chassi"
                       placeholder="Número do chassi" th:value="${param.chassi}"/>
              </div>

              <div class="input-group">
                <label for="modelo">Modelo</label>
                <select id="modelo" name="modelo" th:value="${param.modelo}">
                  <option value="">Selecione um modelo</option>
                  <option value="MOTTU_E">Mottu-E</option>
                  <option value="MOTTU_POP">Mottu-Pop</option>
                  <option value="MOTTU_SPORT">Mottu-Sport</option>
                </select>
              </div>

              <div class="input-group">
                <label for="status">Status</label>
                <select id="status" name="status" th:value="${param.status}">
                  <option value="">Selecione um status</option>
                  <option value="DISPONIVEL">Disponível</option>
                  <option value="AVALIACAO">Em avaliação</option>
                  <option value="MANUTENCAO">Em manutenção</option>
                </select>
              </div>
          </div>

          <div class="filtros_botoes">
            <button class="botao_filtar" type="submit">
              <i class="fas fa-filter"></i> Aplicar filtros
            </button>
            <a th:href="@{/motos}" class="botao_limpar_filtro">
              <i class="fas fa-broom"></i> Limpar filtros
            </a>
          </div>
        </form>
      </section>

      <section class="secao_lista_motos">
        <div class="lista_motos_header">
          <h2>Motos Cadastradas</h2>
          <a href="/motos/cadastrar" class="btn_criar_moto" sec:authorize="hasAuthority('ADMIN')">
            <i class="fas fa-plus"></i>Cadastrar Moto</a
          >
        </div>

        <p class="mensagem-vazia" th:if="${mensagemVazio}">
          Nenhuma moto cadastrada ainda.
        </p>

        <p class="mensagem-vazia" th:if="${mensagemFiltro}">
          Nenhuma moto encontrada com os filtros informados.
        </p>

        <div class="lista_motos">

          <div class="moto_card" th:each="moto : ${motos}">
          <span class="status_badge"
                th:classappend="${moto.status.name() == 'AVALIACAO' ? 'status-em_analise' :
                       moto.status.name() == 'MANUTENCAO' ? 'status-em_manutencao' :
                       moto.status.name() == 'DISPONIVEL' ? 'status-disponivel' : ''}"
                th:text="${moto.status.name() == 'AVALIACAO' ? 'Avaliação' :
                moto.status.name() == 'MANUTENCAO' ? 'Manutenção' :
                moto.status.name() == 'DISPONIVEL' ? 'Disponível' : moto.status.name()}">
          </span>

            <div class="moto_card_cabecalho">
              <h3 th:text="${moto.modelo.name() == 'MOTTU_POP' ? 'Mottu-Pop' :
                        moto.modelo.name() == 'MOTTU_SPORT' ? 'Mottu-Sport' :
                        moto.modelo.name() == 'MOTTU_E' ? 'Mottu-E' : 'Outro'}">
                Modelo
              </h3>
              <div class="imagem_container">
                <img th:src="${moto.modelo.name() == 'MOTTU_POP' ? '/img/mottu-pop.png' :
                   moto.modelo.name() == 'MOTTU_SPORT' ? '/img/mottu-sport.png' :
                   moto.modelo.name() == 'MOTTU_E' ? '/img/mottu-e.png' : '/img/mottu-e.png'}"
                     th:alt="${moto.modelo.name()}"/>
              </div>
            </div>

            <div class="info">
              <p><strong>Placa:</strong> <span th:text="${moto.placa}">Placa</span></p>
              <p><strong>Chassi:</strong> <span th:text="${moto.chassi}">Chassi</span></p>
              <p><strong>Departamento Atual:</strong>
                <span th:text="${moto.movimentacoes.size() > 0 ? moto.movimentacoes.get(0).departamento.descricao : 'Sem movimentações'}"></span>
              </p>
            </div>

            <div class="movimentacoes">
              <p><strong>Últimas Movimentações:</strong></p>
              <ul>
                <li th:each="mov : ${moto.movimentacoes}"
                    th:text="${mov.departamento != null ? mov.departamento.descricao + ' - ' + #temporals.format(mov.dataMovimentacao, 'dd/MM/yyyy') : #temporals.format(mov.dataMovimentacao, 'dd/MM/yyyy')}">
                  Movimentação
                </li>
              </ul>
            </div>

            <div class="alertas">
              <p><strong>Alertas:</strong></p>
              <ul>
                <li th:each="alerta : ${moto.alertas}"
                    th:text="${alerta.mensagem != null ? alerta.mensagem + ' - ' + #temporals.format(alerta.dataAlerta, 'dd/MM/yyyy') : #temporals.format(alerta.dataAlerta, 'dd/MM/yyyy')}">
                  Alertas
                </li>
              </ul>
            </div>

            <div class="botoes_card_moto">
              <a th:href="@{'/motos/editar/' + ${moto.id}}" class="btn_card_moto btn_editar_moto" sec:authorize="hasAuthority('ADMIN')">
                <i class="fas fa-edit"></i> Editar
              </a>
              <a th:href="@{'/movimentacoes/moto/' + ${moto.id}}" class="btn_card_moto btn_movimentacoes">
                <i class="fas fa-exchange-alt"></i> Movimentações
              </a>
              <a th:href="@{'/alertas/moto/' + ${moto.id}}" class="btn_card_moto btn_alertas">
                <i class="fas fa-bell"></i> Alertas
              </a>
              <button class="btn_card_moto btn_deletar_moto" th:onclick="'abrirModal(' + ${moto.id} + ')'" sec:authorize="hasAuthority('ADMIN')">
                <i class="fas fa-trash"></i> Deletar
              </button>
            </div>
          </div>

        </div>
      </section>
    </main>

    <div th:replace="fragments/footer :: footerFragment"></div>

    <!-- Modal -->
    <div id="modalExcluir" class="modal">
      <div class="modal-conteudo">
        <h3>Confirmação</h3>
        <p>Tem certeza que deseja excluir esta moto?</p>
        <div class="modal-botoes">
          <button id="confirmarExcluir" class="btn btn_excluir">Sim, excluir</button>
          <button onclick="fecharModal()" class="btn btn_cancelar">Cancelar</button>
        </div>
      </div>
    </div>
  </body>
</html>
