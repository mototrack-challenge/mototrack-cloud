<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MotoTrack - Movimentações</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/movimentacoes.css}" />
    <link rel="stylesheet" th:href="@{/css/cabecalho-rodape.css}" />
    <script th:src="@{/js/modal-movimentacao.js}" defer></script>
</head>
<body>
    <div th:replace="fragments/header :: headerFragment"></div>

    <main class="container_main">
        <div class="pagina_cabecalho">
            <div class="pagina_titulo">
                <h2><i class="fas fa-exchange-alt"></i> Movimentações da Moto</h2>
            </div>
            <div class="pagina_acoes">
                <a href="/motos" class="btn_voltar"><i class="fas fa-arrow-left"></i> Voltar para Lista</a>
                <button class="btn_adicionar" id="btnNovaMovimentacao"><i class="fas fa-plus"></i> Nova Movimentação</button>
            </div>
        </div>

        <div class="moto_info">
            <img th:src="${moto.modelo.name() == 'MOTTU_POP' ? '/img/mottu-pop.png' :
                   moto.modelo.name() == 'MOTTU_SPORT' ? '/img/mottu-sport.png' :
                   moto.modelo.name() == 'MOTTU_E' ? '/img/mottu-e.png' : '/img/mottu-e.png'}"
                 th:alt="${moto.modelo.name()}"/>
            <div class="moto_detalhes">
                <h3 th:text="${moto.modelo.name() == 'MOTTU_POP' ? 'Mottu-Pop' :
                        moto.modelo.name() == 'MOTTU_SPORT' ? 'Mottu-Sport' :
                        moto.modelo.name() == 'MOTTU_E' ? 'Mottu-E' : 'Outro'}">
                    Modelo
                </h3>
                <p><strong>Placa:</strong> <span th:text="${moto.placa}">Placa</span></p>
                <p><strong>Chassi:</strong> <span th:text="${moto.chassi}">Chassi</span></p>
                <p><strong>Status atual:</strong> <span th:text="${moto.status.name() == 'AVALIACAO' ? 'Avaliação' :
                    moto.status.name() == 'MANUTENCAO' ? 'Manutenção' :
                    moto.status.name() == 'DISPONIVEL' ? 'Disponível' : moto.status.name()}">
                </span></p>
            </div>
        </div>

        <div class="container_lista_movimentacoes">

            <div th:if="${#lists.isEmpty(movimentacoes)}" class="sem_movimentacoes">
                <p><i class="fas fa-info-circle"></i> Nenhuma movimentação cadastrada para esta moto.</p>
            </div>

            <div class="movimentacoes_lista">
                <div class="movimentacao_card" th:each="movimentacao, stat : ${movimentacoes}">
                    <div class="movimentacao_header">
                        <div class="movimentacao_titulo">Movimentação #<span th:text="${stat.count}"></span></div>
                        <div class="movimentacao_data" th:text="${#temporals.format(movimentacao.dataMovimentacao, 'dd/MM/yyyy HH:mm')}">data</div>
                    </div>
                    <div class="movimentacao_departamento">
                        <strong>Departamento:</strong> <span th:text="${movimentacao.departamento != null ? movimentacao.departamento.descricao : 'Sem departamento'}"></span>
                    </div>
                    <div class="movimentacao_acoes">
                        <button class="btn_deletar" th:onclick="'abrirModalExcluir(' + ${movimentacao.id} + ')'">
                            <i class="fas fa-trash"></i> Deletar
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Modal para nova movimentação -->
    <div class="modal" id="modalCadastrarMovimentacao">
        <div class="modal_content">
            <div class="modal_header">
                <h3><i class="fas fa-exchange-alt"></i> Nova Movimentação</h3>
                <button class="fechar_modal">&times;</button>
            </div>
            
            <form id="formMovimentacao" th:action="@{/movimentacoes/cadastrar}" method="post">
                <input type="hidden" name="idMoto" th:value="${moto.id}" />

                <div class="form_grupo">
                    <label for="departamento">Departamento <span class="obrigatorio">*</span></label>
                    <select id="departamento" name="idDepartamento" required>
                        <option value="">Selecione um departamento</option>
                        <option th:each="dep : ${departamentos}"
                                th:value="${dep.id}"
                                th:text="${dep.descricao}">Departamento</option>
                    </select>
                </div>

                <div class="modal_botoes">
                    <button type="button" class="btn_cancelar" id="btnCancelar">Cancelar</button>
                    <button type="submit" class="btn_salvar"><i class="fas fa-save"></i> Salvar Movimentação</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Deletar -->
    <div id="modalExcluir" class="modal_deletar">
        <div class="modal-conteudo">
            <h3>Confirmação</h3>
            <p>Tem certeza que deseja excluir esta movimentação?</p>
            <div class="modal-botoes">
                <button id="confirmarExcluir" class="btn btn_excluir">Sim, excluir</button>
                <button onclick="fecharModalExcluir()" class="btn btn_cancelar">Cancelar</button>
            </div>
        </div>
    </div>

    <div th:replace="fragments/footer :: footerFragment"></div>
</body>
</html>